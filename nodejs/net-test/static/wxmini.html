<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
	<title>xcx</title>
	<style type="text/css">
		html {
			width: 100%;
			height: 100%;
			-webkit-text-size-adjust: 100%;
			-webkit-tap-highlight-color: transparent;
			font-family: -apple-system,BlinkMacSystemFont,Roboto,Cantarell,'Helvetica Neue',Helvetica,Arial,sans-serif;
			box-sizing: border-box;
		}
		*, ::after, ::before {
   	  box-sizing: inherit;
		}
		body {
			width: 100%;
			height: 100%;
			padding: 30px;
			margin: 0;
		}

    button {
      font-size: 16px;
    }
	</style>
</head>
<body>

<button onclick="test1()">postMessage</button>

<code id="message"></code>

<script type="text/javascript">
	function log() {
		var args = Array.prototype.slice.call(arguments);
		console.log.apply(console, args);
		var msgDom = document.getElementById('message');
		msgDom.innerText = msgDom.innerText + '\n------\n' + args.join(' ');
	}
	log(navigator.userAgent);
	log('__wxjs_environment1', window.__wxjs_environment);
</script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>
<script type="text/javascript">
	
	function ready() {
		log('ready', window.__wxjs_environment) // true
	}
	if (!window.WeixinJSBridge || !WeixinJSBridge.invoke) {
		document.addEventListener('WeixinJSBridgeReady', ready, false)
	} else {
		ready()
	}

	wx.miniProgram.getEnv(function(res) {
		log('miniProgram.getEnv', res.miniprogram) // true
	})

	function test1() {
		wx.miniProgram.postMessage({
      data: 'xxx',
      xxx: 1,
      a: 2,
    });
    location.reload();
    // history.pushState(null, null, '#xxx' + Date.now());
	}

</script>
</body>
</html>
